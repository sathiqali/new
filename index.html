<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
    <title>Email Resource Validator | Check Links and Images in Marketing Emails</title>
    <meta name="description" content="A tool to validate links and images in marketing emails, ensuring all resources are accessible before sending to customers." />
    <meta name="keywords" content="email validation, marketing email, link checker, email resources" />
    <meta name="author" content="Email Resource Validator" />
    
    <!-- Open Graph / Social Media Meta Tags -->
    <meta property="og:title" content="Email Resource Validator" />
    <meta property="og:description" content="Validate all links and images in your marketing emails before sending them out." />
    <meta property="og:type" content="website" />
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ“©</text></svg>" />
    
    <!-- Force static mode for GitHub Pages -->
    <script>
      window.ENV = {
        STATIC_MODE: true,
        CORS_PROXY: "https://corsproxy.io/?"
      };
    </script>
    
    <!-- Bootstrap CSS (CDN version) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Custom CSS -->
    <style>
      :root {
        --primary-color: #4a6cf7;
        --primary-hover: #2952e3;
        --secondary-color: #6c757d;
        --success-color: #28a745;
        --danger-color: #dc3545;
        --warning-color: #ffc107;
        --info-color: #17a2b8;
        --light-color: #f8f9fa;
        --dark-color: #343a40;
        --body-bg: #f9fafb;
        --card-bg: #ffffff;
      }
      
      body {
        background-color: var(--body-bg);
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        padding-bottom: 50px;
      }
      
      .navbar {
        background: linear-gradient(to right, #4a6cf7, #2952e3);
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      }
      
      .navbar-brand {
        font-weight: 700;
        color: white !important;
      }
      
      .card {
        border-radius: 8px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        background-color: var(--card-bg);
        margin-bottom: 20px;
      }
      
      .card-header {
        border-top-left-radius: 8px !important;
        border-top-right-radius: 8px !important;
        background-color: rgba(74, 108, 247, 0.05);
        font-weight: 600;
      }
      
      .btn-primary {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
      }
      
      .btn-primary:hover {
        background-color: var(--primary-hover);
        border-color: var(--primary-hover);
      }
      
      .form-control:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 0.2rem rgba(74, 108, 247, 0.25);
      }
      
      .nav-tabs .nav-link.active {
        color: var(--primary-color);
        border-color: var(--light-color) var(--light-color) var(--primary-color);
        border-bottom-width: 2px;
      }
      
      .spinner-grow {
        color: var(--primary-color);
      }
      
      .badge-success {
        background-color: var(--success-color);
      }
      
      .badge-danger {
        background-color: var(--danger-color);
      }
      
      .badge-warning {
        background-color: var(--warning-color);
        color: #212529;
      }
      
      .badge-info {
        background-color: var(--info-color);
      }
      
      .text-primary {
        color: var(--primary-color) !important;
      }
      
      .bg-light {
        background-color: var(--light-color) !important;
      }
      
      footer {
        margin-top: 3rem;
        padding: 1.5rem 0;
        background-color: var(--light-color);
        text-align: center;
      }
      
      .result-item {
        transition: all 0.2s ease;
      }
      
      .result-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 12px rgba(0,0,0,0.1);
      }
      
      .resource-status {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        display: inline-block;
        margin-right: 5px;
      }
      
      .status-200 { background-color: #28a745; }
      .status-300 { background-color: #17a2b8; }
      .status-400 { background-color: #ffc107; }
      .status-500 { background-color: #dc3545; }
      .status-timeout { background-color: #6c757d; }
      
      .gradient-text {
        background: linear-gradient(45deg, #4a6cf7, #2952e3);
        background-clip: text;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        font-weight: 700;
      }
      
      .highlight-container {
        position: relative;
      }
      
      .highlight {
        position: absolute;
        bottom: -3px;
        left: 0;
        height: 10px;
        width: 100%;
        background-color: rgba(74, 108, 247, 0.2);
        z-index: -1;
      }
      
      .top-banner {
        background: linear-gradient(to right, #4a6cf7, #2952e3);
        color: white;
        padding: 3rem 0;
        margin-bottom: 2rem;
      }
      
      .stats-pill {
        border-radius: 20px;
        padding: 0.25rem 0.75rem;
        margin: 0 0.25rem;
        font-size: 0.85rem;
        font-weight: 600;
        background-color: rgba(255,255,255,0.2);
      }
      
      @media (max-width: 768px) {
        .top-banner {
          padding: 2rem 0;
        }
        .gradient-text {
          font-size: 1.75rem;
        }
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-dark mb-4">
      <div class="container">
        <span class="navbar-brand">
          ðŸ“© Email Resource Validator
        </span>
      </div>
    </nav>
    
    <div class="container">
      <div class="row justify-content-center">
        <div class="col-lg-12">
          <div class="text-center mb-4">
            <h1 class="gradient-text">Validate Your Email Resources</h1>
            <p class="lead">Enter your "View in Browser" email URL to check all links and images</p>
          </div>
        </div>
      </div>
      
      <div class="row justify-content-center">
        <div class="col-lg-12">
          <div class="card">
            <div class="card-header">Email URL</div>
            <div class="card-body">
              <form id="email-form">
                <div class="mb-3">
                  <label for="email-url" class="form-label">Enter the "View in Browser" URL from your email:</label>
                  <input type="url" class="form-control" id="email-url" placeholder="https://example.com/view-email?id=123" required>
                  <div class="form-text">This is usually found as a "View in Browser" link in marketing emails.</div>
                </div>
                <button type="submit" class="btn btn-primary" id="validate-btn">
                  <span id="spinner" class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                  Validate Resources
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>
      
      <div class="row mt-4 d-none" id="results-section">
        <div class="col-lg-12">
          <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
              <span>Validation Results</span>
              <div>
                <button class="btn btn-sm btn-outline-primary me-2" id="export-csv">Export to CSV</button>
                <button class="btn btn-sm btn-outline-secondary" id="clear-results">Clear Results</button>
              </div>
            </div>
            <div class="card-body">
              <div class="mb-3">
                <div class="d-flex align-items-center mb-3">
                  <div class="me-2">Filter:</div>
                  <div class="btn-group" role="group">
                    <button type="button" class="btn btn-sm btn-outline-primary active" data-filter="all">All</button>
                    <button type="button" class="btn btn-sm btn-outline-success" data-filter="valid">Valid</button>
                    <button type="button" class="btn btn-sm btn-outline-danger" data-filter="invalid">Invalid</button>
                    <button type="button" class="btn btn-sm btn-outline-info" data-filter="redirect">Redirects</button>
                    <button type="button" class="btn btn-sm btn-outline-secondary" data-filter="links">Links</button>
                    <button type="button" class="btn btn-sm btn-outline-secondary" data-filter="images">Images</button>
                  </div>
                </div>
                
                <div id="stats-container" class="card mb-3 bg-light">
                  <div class="card-body">
                    <h5 class="card-title">Statistics</h5>
                    <div class="d-flex flex-wrap">
                      <div class="me-3 mb-2">
                        <strong>Total Resources:</strong> <span id="total-count">0</span>
                      </div>
                      <div class="me-3 mb-2">
                        <strong>Valid:</strong> <span id="valid-count">0</span>
                      </div>
                      <div class="me-3 mb-2">
                        <strong>Invalid:</strong> <span id="invalid-count">0</span>
                      </div>
                      <div class="me-3 mb-2">
                        <strong>Redirects:</strong> <span id="redirect-count">0</span>
                      </div>
                      <div class="me-3 mb-2">
                        <strong>Links:</strong> <span id="link-count">0</span>
                      </div>
                      <div class="me-3 mb-2">
                        <strong>Images:</strong> <span id="image-count">0</span>
                      </div>
                    </div>
                    <div class="mt-2">
                      <strong>Historical:</strong> 
                      <span id="total-emails">0</span> emails validated, 
                      <span id="total-resources">0</span> resources checked
                    </div>
                  </div>
                </div>
                
                <div id="results-container" class="list-group">
                  <!-- Results will be populated here -->
                  <div class="text-center py-5" id="no-results">
                    <p class="text-muted">Enter an email URL and click "Validate Resources" to see results</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <footer class="mt-5">
      <div class="container">
        <p class="mb-0">Email Resource Validator &copy; 2023</p>
      </div>
    </footer>
    
    <!-- Bootstrap JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Application JavaScript -->
    <script>
      // LocalStorage Keys
      const STORAGE_KEYS = {
        EMAILS_PROCESSED: 'emailValidator_emailsProcessed',
        RESOURCES_VALIDATED: 'emailValidator_resourcesValidated'
      };
      
      // Statistics counters
      let stats = {
        totalEmails: parseInt(localStorage.getItem(STORAGE_KEYS.EMAILS_PROCESSED) || '0'),
        totalResources: parseInt(localStorage.getItem(STORAGE_KEYS.RESOURCES_VALIDATED) || '0')
      };
      
      // Current batch of results
      let currentResults = [];
      
      // DOM Elements
      const emailForm = document.getElementById('email-form');
      const emailUrlInput = document.getElementById('email-url');
      const validateBtn = document.getElementById('validate-btn');
      const spinner = document.getElementById('spinner');
      const resultsSection = document.getElementById('results-section');
      const resultsContainer = document.getElementById('results-container');
      const noResults = document.getElementById('no-results');
      const exportCsvBtn = document.getElementById('export-csv');
      const clearResultsBtn = document.getElementById('clear-results');
      const filterButtons = document.querySelectorAll('[data-filter]');
      
      // Stats elements
      const totalCount = document.getElementById('total-count');
      const validCount = document.getElementById('valid-count');
      const invalidCount = document.getElementById('invalid-count');
      const redirectCount = document.getElementById('redirect-count');
      const linkCount = document.getElementById('link-count');
      const imageCount = document.getElementById('image-count');
      const totalEmails = document.getElementById('total-emails');
      const totalResources = document.getElementById('total-resources');
      
      // Initialize statistics
      updateHistoricalStats();
      
      // Event Listeners
      emailForm.addEventListener('submit', handleFormSubmit);
      exportCsvBtn.addEventListener('click', exportToCsv);
      clearResultsBtn.addEventListener('click', clearResults);
      
      // Filter buttons
      filterButtons.forEach(button => {
        button.addEventListener('click', () => {
          // Remove active class from all buttons
          filterButtons.forEach(btn => btn.classList.remove('active'));
          // Add active class to clicked button
          button.classList.add('active');
          // Apply filter
          applyFilter(button.dataset.filter);
        });
      });
      
      // Function to handle form submission
      async function handleFormSubmit(e) {
        e.preventDefault();
        const emailUrl = emailUrlInput.value.trim();
        
        if (!emailUrl) {
          alert('Please enter a valid email URL');
          return;
        }
        
        // Show loading state
        setLoading(true);
        
        try {
          // Fetch the email content
          const emailContent = await fetchEmailContent(emailUrl);
          
          // Extract resources
          const resources = extractResources(emailContent, emailUrl);
          
          // Validate resources
          const validatedResources = await validateResources(resources);
          
          // Update statistics
          stats.totalEmails++;
          stats.totalResources += validatedResources.length;
          saveStatistics();
          
          // Display results
          displayResults(validatedResources);
          
          // Store current results
          currentResults = validatedResources;
          
        } catch (error) {
          console.error('Error validating email:', error);
          alert(`Error: ${error.message || 'Failed to validate email resources'}`);
        } finally {
          setLoading(false);
        }
      }
      
      // Function to fetch email content
      async function fetchEmailContent(url) {
        // For GitHub Pages, use a CORS proxy
        const proxyUrl = `${window.ENV.CORS_PROXY}${encodeURIComponent(url)}`;
        
        const response = await fetch(proxyUrl);
        
        if (!response.ok) {
          throw new Error(`Failed to fetch email content: ${response.status} ${response.statusText}`);
        }
        
        return await response.text();
      }
      
      // Function to extract resources from HTML
      function extractResources(html, baseUrl) {
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, 'text/html');
        
        // Extract links
        const links = Array.from(doc.querySelectorAll('a[href]'))
          .map(a => {
            const href = a.getAttribute('href');
            return {
              url: resolveUrl(href, baseUrl),
              type: 'link',
              text: a.textContent.trim() || href
            };
          })
          .filter(link => isValidUrl(link.url));
        
        // Extract images
        const images = Array.from(doc.querySelectorAll('img[src]'))
          .map(img => {
            const src = img.getAttribute('src');
            return {
              url: resolveUrl(src, baseUrl),
              type: 'image',
              text: img.getAttribute('alt') || src
            };
          })
          .filter(image => isValidUrl(image.url));
        
        // Combine and deduplicate
        const allResources = [...links, ...images];
        const uniqueResources = [];
        const seenUrls = new Set();
        
        for (const resource of allResources) {
          if (!seenUrls.has(resource.url)) {
            seenUrls.add(resource.url);
            uniqueResources.push(resource);
          }
        }
        
        return uniqueResources;
      }
      
      // Function to validate resources
      async function validateResources(resources) {
        const validatedResources = [];
        const batchSize = 5; // Process in batches to avoid rate limits
        
        // Process resources in batches
        for (let i = 0; i < resources.length; i += batchSize) {
          const batch = resources.slice(i, i + batchSize);
          const batchPromises = batch.map(resource => validateResource(resource));
          
          // Wait for batch to complete
          const results = await Promise.all(batchPromises);
          validatedResources.push(...results);
          
          // Add a small delay between batches to avoid rate limiting
          if (i + batchSize < resources.length) {
            await new Promise(resolve => setTimeout(resolve, 500));
          }
        }
        
        return validatedResources;
      }
      
      // Function to validate a single resource
      async function validateResource(resource) {
        try {
          // For GitHub Pages, use a CORS proxy with no-cors mode
          const proxyUrl = `${window.ENV.CORS_PROXY}${encodeURIComponent(resource.url)}`;
          
          // Create an AbortController to timeout the request
          const controller = new AbortController();
          const timeoutId = setTimeout(() => controller.abort(), 10000); // 10 second timeout
          
          try {
            const response = await fetch(proxyUrl, {
              method: 'HEAD',
              signal: controller.signal,
              mode: 'cors'
            });
            
            clearTimeout(timeoutId);
            
            const isRedirect = response.redirected || 
                             (response.status >= 300 && response.status < 400);
            
            return {
              ...resource,
              status: response.status,
              statusText: response.statusText,
              isValid: response.ok || isRedirect,
              isRedirect: isRedirect,
              redirectUrl: isRedirect ? response.url : null
            };
          } catch (error) {
            clearTimeout(timeoutId);
            
            // Special handling for IBM download links that often fail with HEAD
            if (resource.url.includes('ibm.com/downloads') || 
                resource.url.includes('utm_medium=Email') || 
                resource.url.includes('utm_source=Nurture')) {
              
              // Try a full GET request for IBM links
              try {
                const getResponse = await fetch(proxyUrl, { 
                  method: 'GET',
                  signal: controller.signal,
                });
                
                const isRedirect = getResponse.redirected || 
                                 (getResponse.status >= 300 && getResponse.status < 400);
                
                return {
                  ...resource,
                  status: getResponse.status,
                  statusText: getResponse.statusText,
                  isValid: getResponse.ok || isRedirect,
                  isRedirect: isRedirect,
                  redirectUrl: isRedirect ? getResponse.url : null
                };
              } catch (getError) {
                // Fall through to error handling
              }
            }
            
            // Handle errors
            if (error.name === 'AbortError') {
              return {
                ...resource,
                status: 0,
                statusText: 'Timeout',
                isValid: false,
                isRedirect: false,
                redirectUrl: null
              };
            }
            
            return {
              ...resource,
              status: 0,
              statusText: error.message || 'Network Error',
              isValid: false,
              isRedirect: false,
              redirectUrl: null
            };
          }
        } catch (error) {
          return {
            ...resource,
            status: 0,
            statusText: error.message || 'Error',
            isValid: false,
            isRedirect: false,
            redirectUrl: null
          };
        }
      }
      
      // Function to display results
      function displayResults(results) {
        // Show results section
        resultsSection.classList.remove('d-none');
        
        // Clear previous results
        resultsContainer.innerHTML = '';
        
        if (results.length === 0) {
          resultsContainer.innerHTML = '<div class="text-center py-5"><p class="text-muted">No resources found in the email</p></div>';
          return;
        }
        
        // Hide no results message
        noResults.classList.add('d-none');
        
        // Add each result
        results.forEach(resource => {
          const statusClass = getStatusClass(resource.status);
          const statusBadge = getStatusBadge(resource);
          
          const resultItem = document.createElement('div');
          resultItem.className = `list-group-item result-item ${resource.type}-item ${resource.isValid ? 'valid-item' : 'invalid-item'} ${resource.isRedirect ? 'redirect-item' : ''}`;
          
          resultItem.innerHTML = `
            <div class="d-flex w-100 justify-content-between align-items-center">
              <div>
                <h6 class="mb-1">
                  <span class="badge bg-secondary me-2">${resource.type}</span>
                  ${statusBadge}
                  <a href="${resource.url}" target="_blank" rel="noopener noreferrer">${resource.text}</a>
                </h6>
                <small class="text-muted d-block text-truncate" style="max-width: 80vw;">${resource.url}</small>
                ${resource.isRedirect ? `<small class="text-info d-block text-truncate" style="max-width: 80vw;">Redirects to: ${resource.redirectUrl}</small>` : ''}
              </div>
            </div>
          `;
          
          resultsContainer.appendChild(resultItem);
        });
        
        // Update statistics counters
        updateStatCounters(results);
      }
      
      // Function to get status badge
      function getStatusBadge(resource) {
        if (resource.status === 0) {
          return '<span class="badge bg-secondary">Timeout</span>';
        } else if (resource.isRedirect) {
          return `<span class="badge bg-info">Redirect ${resource.status}</span>`;
        } else if (resource.isValid) {
          return `<span class="badge bg-success">${resource.status}</span>`;
        } else if (resource.status >= 400 && resource.status < 500) {
          return `<span class="badge bg-warning">${resource.status}</span>`;
        } else if (resource.status >= 500) {
          return `<span class="badge bg-danger">${resource.status}</span>`;
        } else {
          return `<span class="badge bg-secondary">${resource.status}</span>`;
        }
      }
      
      // Function to get status class
      function getStatusClass(status) {
        if (status >= 200 && status < 300) {
          return 'status-200';
        } else if (status >= 300 && status < 400) {
          return 'status-300';
        } else if (status >= 400 && status < 500) {
          return 'status-400';
        } else if (status >= 500) {
          return 'status-500';
        } else {
          return 'status-timeout';
        }
      }
      
      // Function to update stat counters
      function updateStatCounters(results) {
        const validResults = results.filter(r => r.isValid);
        const invalidResults = results.filter(r => !r.isValid);
        const redirectResults = results.filter(r => r.isRedirect);
        const linkResults = results.filter(r => r.type === 'link');
        const imageResults = results.filter(r => r.type === 'image');
        
        totalCount.textContent = results.length;
        validCount.textContent = validResults.length;
        invalidCount.textContent = invalidResults.length;
        redirectCount.textContent = redirectResults.length;
        linkCount.textContent = linkResults.length;
        imageCount.textContent = imageResults.length;
        
        // Update historical stats
        updateHistoricalStats();
      }
      
      // Function to update historical stats
      function updateHistoricalStats() {
        totalEmails.textContent = stats.totalEmails;
        totalResources.textContent = stats.totalResources;
      }
      
      // Function to save statistics
      function saveStatistics() {
        localStorage.setItem(STORAGE_KEYS.EMAILS_PROCESSED, stats.totalEmails.toString());
        localStorage.setItem(STORAGE_KEYS.RESOURCES_VALIDATED, stats.totalResources.toString());
        updateHistoricalStats();
      }
      
      // Function to set loading state
      function setLoading(isLoading) {
        if (isLoading) {
          spinner.classList.remove('d-none');
          validateBtn.setAttribute('disabled', 'true');
          validateBtn.textContent = ' Validating...';
          validateBtn.prepend(spinner);
        } else {
          spinner.classList.add('d-none');
          validateBtn.removeAttribute('disabled');
          validateBtn.textContent = 'Validate Resources';
        }
      }
      
      // Function to apply filter
      function applyFilter(filter) {
        const items = document.querySelectorAll('.result-item');
        
        items.forEach(item => {
          if (filter === 'all') {
            item.style.display = '';
          } else if (filter === 'valid' && item.classList.contains('valid-item')) {
            item.style.display = '';
          } else if (filter === 'invalid' && item.classList.contains('invalid-item')) {
            item.style.display = '';
          } else if (filter === 'redirect' && item.classList.contains('redirect-item')) {
            item.style.display = '';
          } else if (filter === 'links' && item.classList.contains('link-item')) {
            item.style.display = '';
          } else if (filter === 'images' && item.classList.contains('image-item')) {
            item.style.display = '';
          } else {
            item.style.display = 'none';
          }
        });
      }
      
      // Function to export to CSV
      function exportToCsv() {
        if (currentResults.length === 0) {
          alert('No results to export');
          return;
        }
        
        const headers = ['Type', 'URL', 'Status', 'Valid', 'Redirect', 'Redirect URL', 'Text'];
        
        const csvRows = [
          headers.join(','),
          ...currentResults.map(resource => [
            escapeCsvValue(resource.type),
            escapeCsvValue(resource.url),
            resource.status,
            resource.isValid ? 'Yes' : 'No',
            resource.isRedirect ? 'Yes' : 'No',
            escapeCsvValue(resource.redirectUrl || ''),
            escapeCsvValue(resource.text)
          ].join(','))
        ];
        
        const csvContent = csvRows.join('\n');
        
        // Create blob and download
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
        const fileName = `email-resources-${timestamp}.csv`;
        
        // Create a link and trigger download
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = fileName;
        link.style.display = 'none';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }
      
      // Function to escape CSV values
      function escapeCsvValue(value) {
        if (value == null) return '';
        const str = String(value);
        if (str.includes(',') || str.includes('"') || str.includes('\n')) {
          return `"${str.replace(/"/g, '""')}"`;
        }
        return str;
      }
      
      // Function to clear results
      function clearResults() {
        resultsContainer.innerHTML = '';
        noResults.classList.remove('d-none');
        currentResults = [];
        resultsSection.classList.add('d-none');
        
        // Reset counters
        totalCount.textContent = '0';
        validCount.textContent = '0';
        invalidCount.textContent = '0';
        redirectCount.textContent = '0';
        linkCount.textContent = '0';
        imageCount.textContent = '0';
      }
      
      // Utility function to resolve relative URLs
      function resolveUrl(url, base) {
        // Handle data URLs directly
        if (url.startsWith('data:')) {
          return url;
        }
        
        try {
          // Attempt to create a URL object to parse the URL
          return new URL(url, base).href;
        } catch (e) {
          console.warn('Invalid URL:', url);
          return url;
        }
      }
      
      // Utility function to check if a string is a valid URL
      function isValidUrl(string) {
        if (!string) return false;
        
        // Data URLs are valid
        if (string.startsWith('data:')) {
          return true;
        }
        
        try {
          const url = new URL(string);
          return url.protocol === 'http:' || url.protocol === 'https:';
        } catch (e) {
          return false;
        }
      }
    </script>
  </body>
</html>